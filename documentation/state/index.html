<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>BagaWork</title>
		<meta name="viewport" content="width=device-width">
		<link rel="icon" href="../../favicon.ico">
		<meta name="theme-color" content="#ffffff">
		
		<link href="../../_app/immutable/assets/2.Cc0q3LI5.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/ViewApp.BmseSdrE.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/ViewApp.D1tK9Ush.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.DfGQzRaj.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/entry.BXzytorx.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/scheduler.B0TnBjPs.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.CBcONjAz.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.4nlP2jWE.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.BXVnRmkj.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.BdJJj93C.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/2.BcGDvMWD.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/each.BaX_zf8z.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/changelog-entries.B0H6TqSg.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/stores.-tGz_jaI.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/38.BU6uiVbn.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.Gu5gcrKE.js">
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">  <div class="layout svelte-e9cs16"><div class="publicAnnouncement svelte-e9cs16"><div class="publicAnnouncement danger svelte-1b45vgo" data-svelte-h="svelte-1cydixr"><strong>Note</strong>: This is a pre-release of BagaWork. Many things will likely change before the first stable release.
</div></div> <div class="nav svelte-e9cs16"><nav class="svelte-f9itgq"><a href="/" class="title svelte-f9itgq" data-svelte-h="svelte-r9hply">BagaWork</a> <div class="links svelte-f9itgq"><a href="/documentation/" target="" class="svelte-f9itgq  isSubCurrent">Documentation</a><a href="/tutorials/" target="" class="svelte-f9itgq">Tutorials</a><a href="/examples/" target="" class="svelte-f9itgq">Examples</a><a href="/editor/" target="_blank" class="svelte-f9itgq">Editor</a><a href="/implementation/" target="" class="svelte-f9itgq">Implementation</a><a href="/contact/" target="" class="svelte-f9itgq">Contact</a> <a class="version svelte-f9itgq" href="/changelog/">v0.0.52</a></div> </nav></div> <aside class="svelte-e9cs16"><aside><div class="group svelte-12md48y"><div class="group-name svelte-12md48y">Views</div> <div class="links svelte-12md48y"><a href="/documentation/component/" class="svelte-12md48y">Component </a><a href="/documentation/button/" class="svelte-12md48y">Button </a><a href="/documentation/enter-number/" class="svelte-12md48y">EnterNumber </a><a href="/documentation/enter-text/" class="svelte-12md48y">EnterText </a><a href="/documentation/html/" class="svelte-12md48y">Html </a><a href="/documentation/space/" class="svelte-12md48y">Space </a><a href="/documentation/text/" class="svelte-12md48y">Text </a><a href="/documentation/updater/" class="svelte-12md48y">Updater </a></div> </div><div class="group svelte-12md48y"><div class="group-name svelte-12md48y">Layouts</div> <div class="links svelte-12md48y"><a href="/documentation/box/" class="svelte-12md48y">Box </a><a href="/documentation/columns/" class="svelte-12md48y">Columns </a><a href="/documentation/layers/" class="svelte-12md48y">Layers </a><a href="/documentation/paper/" class="svelte-12md48y">Paper </a><a href="/documentation/rows/" class="svelte-12md48y">Rows </a></div> </div><div class="group svelte-12md48y"><div class="group-name svelte-12md48y">Paper Figures</div> <div class="links svelte-12md48y"><a href="/documentation/paper-figure/" class="svelte-12md48y">PaperFigure </a><a href="/documentation/paper-circle/" class="svelte-12md48y">PaperCircle </a><a href="/documentation/paper-line/" class="svelte-12md48y">PaperLine </a><a href="/documentation/paper-group/" class="svelte-12md48y">PaperGroup </a><a href="/documentation/paper-rectangle/" class="svelte-12md48y">PaperRectangle </a></div> </div><div class="group svelte-12md48y"><div class="group-name svelte-12md48y">Classes</div> <div class="links svelte-12md48y"><a href="/documentation/app/" class="svelte-12md48y">App </a><a href="/documentation/direction/" class="svelte-12md48y">Direction </a><a href="/documentation/duration/" class="svelte-12md48y">Duration </a><a href="/documentation/font/" class="svelte-12md48y">Font </a><a href="/documentation/page/" class="svelte-12md48y">Page </a><a href="/documentation/time/" class="svelte-12md48y">Time </a></div> </div><div class="group svelte-12md48y"><div class="group-name svelte-12md48y">Variables</div> <div class="links svelte-12md48y"><a href="/documentation/a/" class="svelte-12md48y">a </a><a href="/documentation/m/" class="svelte-12md48y">m </a><a href="/documentation/p/" class="svelte-12md48y">p </a><a href="/documentation/speaker/" class="svelte-12md48y">speaker </a></div> </div><div class="group svelte-12md48y"><div class="group-name svelte-12md48y">Functions</div> <div class="links svelte-12md48y"><a href="/documentation/log/" class="svelte-12md48y">log() </a><a href="/documentation/run-updater/" class="svelte-12md48y">runUpdater() </a></div> </div><div class="group svelte-12md48y"><div class="group-name svelte-12md48y">Various</div> <div class="links svelte-12md48y"><a href="/documentation/bbcode/" class="svelte-12md48y">BBCode </a><a href="/documentation/state/" class="svelte-12md48y isCurrent">State </a><a href="/documentation/text-symbols/" class="svelte-12md48y">Text Symbols </a><a href="/documentation/units/" class="svelte-12md48y">Units </a></div> </div> </aside></aside> <main class="svelte-e9cs16"><h1 data-svelte-h="svelte-rw95v5">State</h1> <p data-svelte-h="svelte-eturi">On this page you find information on how the state in a BagaWork app is handled, and how you can customize it.</p> <h2 data-svelte-h="svelte-1ukekoe">Introduction</h2> <p data-svelte-h="svelte-q31691">When the user starts running your BagaWork app, the user&#39;s computer will create a <em>state</em> that contains the information it needs to remember to be able to run the app. The state does primarily consist of:</p> <ul data-svelte-h="svelte-z00lf0"><li>All the app variables</li> <li>All the page variables</li> <li>The name of the page that is currently shown in the app (e.g. <code>`StartPage`</code>)</li> <li>The version of the app that is running (e.g. <code>1</code>)</li></ul> <p data-svelte-h="svelte-f3j74u">As the user runs the app, the state will change (e.g. app and page variables will be assigned new values, etc.).</p> <h2 data-svelte-h="svelte-j9s9n5">Viewing the state</h2> <p data-svelte-h="svelte-1nhvrk4">In our <a target="_blank" href="/editor" title="Open our Online Editor">Online Editor</a>, you can easily view the state of your app by clicking on a page, and then on the <code>State</code> tab in the upper right corner.</p> <p data-svelte-h="svelte-3bh428">In our Online Editor, the state is shown as JSON code. JSON is a quite simple data format, and it works very similar to the most common values in JavaScript.</p> <div class="remark-container tip"><div class="remark-container__title" data-svelte-h="svelte-1llzxwj">Example</div><p data-svelte-h="svelte-n07ngg">Example of what a state in BagaWork can look like in JSON format.</p><pre class="language-json"><!-- HTML_TAG_START --><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"version"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">"currentPageName"</span><span class="token operator">:</span> <span class="token string">"Page2"</span><span class="token punctuation">,</span>
	<span class="token property">"app"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">43</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"CoverPage"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
			<span class="token property">"counter"</span><span class="token operator">:</span> <span class="token number">3</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token property">"Page1"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token property">"Page2"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
			<span class="token property">"hasStarted"</span><span class="token operator">:</span> <span class="token boolean">true</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token property">"Page3"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token property">"Page4"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre><p data-svelte-h="svelte-13c5hrv">In this example, we can see that:</p><ul data-svelte-h="svelte-mp14dm"><li>the user is running version <code>1</code> of the app</li> <li>the page named <code>Page2</code> is currently shown to the user</li> <li>the app variable <code>age</code> has the value <code>43</code></li> <li>the page named <code>CoverPage</code> has a page variable named <code>counter</code> with the value <code>3</code></li> <li>the page named <code>Page1</code> has no page variables</li> <li>Etc.</li></ul></div> <div class="remark-container warning" data-svelte-h="svelte-1viwvhq"><div class="remark-container__title">Strings in JSON</div><p>In JavaScript you can create a string by surrounding the text with:</p><ul><li>Two <code>`</code> characters, or</li> <li>Two <code>&quot;</code> characters, or</li> <li>Two <code>&#39;</code> characters</li> </ul><p>But in JSON, you must use two <code>&quot;</code> characters.</p></div> <h2 data-svelte-h="svelte-1q2wiae">Storing the state</h2> <p data-svelte-h="svelte-1gwoyvm">If your BagaWork app is running on a website that <strong>does not support</strong> storing the app&#39;s state on the user&#39;s computer, then each time the user starts the app, it will initialize a new state from scratch to use. An example of such a website is this website (<a href="https://bagawork.com/" rel="nofollow" target="_blank">bagawork.com</a>). bagawork.com is hosted on <a href="https://pages.github.com/" rel="nofollow" target="_blank">GitHub Pages</a>, and therefor it can&#39;t function as an app hosting server, so it can only be used to quickly share apps for testing/debugging. Apps running on such websites can&#39;t remember information between runs.</p> <p data-svelte-h="svelte-1iy2s6n">If your BagaWork app on the other hand is running on a website that <strong>does support</strong> storing the app&#39;s state on the user&#39;s computer, then each time the app loads a page, its state will be stored, and if the user then closes the app and later opens it again, it will resume using the state that was stored, instead of initializing a new state from scratch. An example of such a website is <a href="https://baggaland.com/" rel="nofollow" target="_blank">bagaland.com</a>. Try running, close and then re-open an app hosted there, and you can see this in action.</p> <p data-svelte-h="svelte-1y18d3h">If you host your app on a website that stores the state between runs, there is  one thing you need to remember: not all values can be stored! Ordinary values like:</p> <ul data-svelte-h="svelte-7enz5c"><li>Strings</li> <li>Numbers</li> <li>Booleans</li> <li>Arrays</li> <li>Etc.</li></ul> <p data-svelte-h="svelte-1dj04se">Can be stored without problem. But, for example, functions can&#39;t be stored; you can&#39;t have an app variable that stores an object that contains a function. If you try to do something like that, then when the user later tries to resume running the app, that function will not exist!</p> <h2 data-svelte-h="svelte-19h2kem">Valid values</h2> <p data-svelte-h="svelte-11g05ny">BagaWork will store the state of your app in JSON format, so the values you store in your app and page variables must be serializable to JSON. The most common values in JavaScript are serializable to JSON, including numbers, strings, booleans, arrays and objects. Checkout <a href="https://www.json.org" rel="nofollow" target="_blank">json.org</a> to learn more about how JSON works.</p> <h2 data-svelte-h="svelte-1anz89b">Changing the state</h2> <p data-svelte-h="svelte-1kgt5dg">In our <a target="_blank" href="/editor" title="Open our Online Editor">Online Editor</a>, where you view the state of the app running, you can also change the state, and then click on the RESTART WITH STATE button to restart the app with the new state you have specified. This functionality can be useful when testing and debugging some of your apps, but not something you have to use.</p> <h2 data-svelte-h="svelte-rtkmzs">Updating apps</h2> <p data-svelte-h="svelte-k2lqfb">When you release a new version of your app, you might have to think about the state your app has stored on the computers where it has run, and adapt it to the new version of your app.</p> <p data-svelte-h="svelte-7w9kux">For example, when a user has run version <code>1</code> of your app, then the state stored on that user&#39;s computer might contain an app variable named <code>counter</code> with the value <code>5</code>, but in version <code>2</code> of your app you have renamed that app variable to <code>clickCounter</code>. When that user then runs version <code>2</code> of your app, BagaWork has no idea that the app variable <code>counter</code> in the stored state should be assigned to the app variable <code>clickCounter</code> in the new version of the app, and you need to write some additional code yourself to make this happen.</p> <p data-svelte-h="svelte-1ijft48">So, when releasing a new version of your app, it&#39;s important to gracefully perform the update, so users that have been using an old version of the app and has a state of the old version stored on their computers won&#39;t get any problems when they start running the new version of your app with that old state. To handle this, <code>App.onUpdate()</code> exists.</p> <div class="remark-container tip" data-svelte-h="svelte-14copen"><div class="remark-container__title">onUpdate() only applies to previous users of your app!</div><p>A user that uses your app for the first time will always start using the latest version of your app, so you only need to worry about <code>App.onUpdate()</code> for users that have run an older version of your app and has a state from that old version stored on their computers.</p></div> <p data-svelte-h="svelte-ek2zj4">There are three things you need to think about when updating a BagaWork app:</p> <ul data-svelte-h="svelte-1kdxnlu"><li>Which page the user currently is on</li> <li>Which app variables your old and new versions have</li> <li>Which page variables your old and new versions have</li></ul> <h3 data-svelte-h="svelte-tj9bl3">Updating the current page</h3> <p data-svelte-h="svelte-17rn2qq">The default update behavior for the user&#39;s current page is:</p> <ol data-svelte-h="svelte-19wfv72"><li>If a page with the same name as the user&#39;s current page in the stored state exists in the new version of the app, then show that page after the update</li> <li>Otherwise, call <code>App.createStartPage()</code> in the new version of the app, and show the page returned from that method</li></ol> <div class="remark-container tip"><div class="remark-container__title" data-svelte-h="svelte-1llzxwj">Example</div><p data-svelte-h="svelte-yj1zk7">Example of code that would use the default update behavior for the user&#39;s current page.</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// This is the new version of the app.</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	<span class="token function">createStartPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token comment">// Return the same old start page here,</span>
		<span class="token comment">// or another one if you want.</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">// You don't need to implement onUpdate()</span>
	<span class="token comment">// at all if you want the default update</span>
	<span class="token comment">// behavior.</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre></div> <p data-svelte-h="svelte-17k9w1v">If you want to show another page to the user directly after the app has been updated, you should implement <code>onUpdate()</code> and send back the page you want to show to the user directly after the update.</p> <div class="remark-container tip"><div class="remark-container__title" data-svelte-h="svelte-1llzxwj">Example</div><p data-svelte-h="svelte-hww4ov">Example of code that would take the user to the <code>ShowNewFeaturesPage</code> after the update.</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// This is the new version of the app.</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	<span class="token comment">// ...</span>
	
	<span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> ShowNewFeaturesPage
	<span class="token punctuation">&#125;</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre></div> <h3 data-svelte-h="svelte-8tak57">Updating the app variables</h3> <p data-svelte-h="svelte-1igw6t6">The default update behavior for the app variables is to:</p> <ol data-svelte-h="svelte-qg4lpn"><li>First create all the app variables with their default values in the new version of your app</li> <li>For each app variable that exists both in the stored state and in the new version of the app:<ul><li>Copy over the value from the stored state to the app variable in the app</li></ul></li></ol> <div class="remark-container tip"><div class="remark-container__title" data-svelte-h="svelte-1llzxwj">Example</div><p data-svelte-h="svelte-3iodai">Example showing which app variables that are delete/added/copied when updating an app.</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// This is the old version of the app.</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	city <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Stockholm</span><span class="token template-punctuation string">&#96;</span></span>
	isBoy <span class="token operator">=</span> <span class="token boolean">true</span>
	
	<span class="token comment">// ...</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// This is the new version of the app.</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	<span class="token comment">// "city" is deleted.</span>
	isBoy <span class="token operator">=</span> <span class="token boolean">true</span>
	age <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment">// This one is added.</span>
	
	<span class="token comment">// ...</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre><p data-svelte-h="svelte-15hq0w9">In the new version of the app:</p><ul data-svelte-h="svelte-1i2vnct"><li>The app variable <code>city</code> will no longer exist</li> <li>The app variable <code>isBoy</code> will have the value <code>true</code> for new users, but for users that have run the previous version of your app and has a stored state it will have whichever value it happened to have in that stored state</li> <li>The app variable <code>age</code> will have the value <code>10</code> for both new and old users of your app</li></ul></div> <p data-svelte-h="svelte-1etntoo">If you need to apply some additional logic when updating, you can implement that in <code>onUpdate()</code>. When <code>onUpdate()</code> is called, it will receive the old app variables in a parameter called <code>oldA</code>, and you can use that to read out their values from it. The default update behavior for the app variables will have been applied before <code>onUpdate()</code> is called.</p> <div class="remark-container tip"><div class="remark-container__title" data-svelte-h="svelte-1llzxwj">Example</div><p data-svelte-h="svelte-d48f8q">Example of how to perform some custom logic when updating the app to a new version.</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// This is the old version of the app.</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	city <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Stockholm</span><span class="token template-punctuation string">&#96;</span></span>
	
	<span class="token comment">// ...</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// This is the new version of the app.</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	<span class="token comment">// Instead of calling the app variable for</span>
	<span class="token comment">// "city", we want to call it "cityName" in</span>
	<span class="token comment">// this new version, but we want old users</span>
	<span class="token comment">// to have the same value it stored as when</span>
	<span class="token comment">// they ran the old version of the app the</span>
	<span class="token comment">// last time...</span>
	cityName <span class="token operator">=</span> <span class="token string">"Stockholm"</span>
	
	<span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token parameter">oldA</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		
		<span class="token comment">// ...so in here, we must read out the</span>
		<span class="token comment">// value of the "city" variable from the</span>
		<span class="token comment">// old app, and store it in the new</span>
		<span class="token comment">// "cityName" variable instead.</span>
		a<span class="token punctuation">.</span>cityName <span class="token operator">=</span> oldA<span class="token punctuation">.</span>city
		
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">// ...</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre></div> <p data-svelte-h="svelte-tlnqdg">What&#39;s been described above is the general logic you need to think about when updating your app to a newer version, BUT it can be a little bit more complicated than this. For example, you might have:</p> <ul data-svelte-h="svelte-2q020e"><li>First released the first version of your app (version <code>1</code>)</li> <li>And then released a new version of your app (version <code>2</code>)</li> <li>And then released a new version of your app (version <code>3</code>)</li></ul> <p data-svelte-h="svelte-3gviwm">So you might have:</p> <ul data-svelte-h="svelte-1ly7mxy"><li>Some really old users that haven&#39;t run your app for a long time, so the last version they used was version <code>1</code></li> <li>Some less old users that used version <code>2</code> of your app the last time they ran your app</li> <li>Your most active users, who use the latest version (version <code>3</code>) of your app</li></ul> <p data-svelte-h="svelte-s7b3sw">So when you release version <code>4</code> of you app, you might have:</p> <ul data-svelte-h="svelte-922as3"><li>Some users that are updating from version <code>1</code></li> <li>Some users that are updating from version <code>2</code></li> <li>Some users that are updating from version <code>3</code></li></ul> <p data-svelte-h="svelte-1o6r4lx">So in <code>onUpdate()</code>, you might need to apply different update logic depending on which version the user is updating from. For this reason, <code>onUpdate()</code> will also be called with a second argument, the <code>oldVersion</code> parameter, which contains a number indicating which version the user is updating from.</p> <div class="remark-container tip"><div class="remark-container__title" data-svelte-h="svelte-1llzxwj">Example</div><p data-svelte-h="svelte-188im2p">Example of the code one usually needs to write when releasing a new version of the app.</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// This is version 4 of the app.</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	<span class="token comment">// ...</span>
	
	<span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token parameter">oldA<span class="token punctuation">,</span> oldVersion</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>oldVersion <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			
			<span class="token comment">// Write code dealing with updates</span>
			<span class="token comment">// from version 1 here.</span>
			
		<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldVersion <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			
			<span class="token comment">// Write code dealing with updates</span>
			<span class="token comment">// from version 2 here.</span>
			
		<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldVersion <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			
			<span class="token comment">// Write code dealing with updates</span>
			<span class="token comment">// from version 3 here.</span>
			
		<span class="token punctuation">&#125;</span>
		
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">// ...</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre></div> <div class="remark-container tip"><div class="remark-container__title" data-svelte-h="svelte-1llzxwj">Example</div><p data-svelte-h="svelte-j3bihx">Here is a bit more complicated and realistic example. This app is about keeping track of information about your friends. In the first version, only the friends&#39; names were registered, so the <code>App</code> class looked like this:</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// Version 1.</span>
<span class="token keyword">class</span> <span class="token class-name">FriendsApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	friends <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Alice</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token comment">// Just some</span>
		<span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Bob</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span>   <span class="token comment">// sample data.</span>
	<span class="token punctuation">]</span>
	
	<span class="token comment">// ...</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre><p data-svelte-h="svelte-1gzbaf0">In the second version, we also wanted to keep track of the age of each friend, so we needed the following code:</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// Version 2.</span>
<span class="token keyword">class</span> <span class="token class-name">FriendsApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	friends <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Alice</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// Just some</span>
		<span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Bob</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span>   <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// sample data.</span>
	<span class="token punctuation">]</span>
	
	<span class="token comment">// ...</span>
	
	<span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token parameter">oldA<span class="token punctuation">,</span> oldVersion</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		
		<span class="token comment">// Since this is version 2, the only</span>
		<span class="token comment">// previous version the user can have</span>
		<span class="token comment">// used is version 1, so we don't need</span>
		<span class="token comment">// to check oldVersion, but it can be</span>
		<span class="token comment">// good to do anyway (consistency).</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>oldVersion <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			
			a<span class="token punctuation">.</span>friends <span class="token operator">=</span> oldA<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>createFriendFromV1<span class="token punctuation">)</span>
			
		<span class="token punctuation">&#125;</span>
		
	<span class="token punctuation">&#125;</span>
	
	<span class="token function">createFriendFromV1</span><span class="token punctuation">(</span><span class="token parameter">friendName</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> friendName<span class="token punctuation">,</span>
			<span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// All old friends gets age 0 by default.</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre><p data-svelte-h="svelte-zuvbbe">In the third version we also want to keep track of which city they live in, so we need the following code:</p><pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token comment">// Version 3.</span>
<span class="token keyword">class</span> <span class="token class-name">FriendsApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span><span class="token punctuation">&#123;</span>
	
	friends <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Alice</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Stockholm</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// Just some</span>
		<span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Bob</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span>   <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Oslo</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token comment">// sample data.</span>
	<span class="token punctuation">]</span>
	
	<span class="token comment">// ...</span>
	
	<span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token parameter">oldA<span class="token punctuation">,</span> oldVersion</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>oldVersion <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			
			<span class="token comment">// Same as before.</span>
			a<span class="token punctuation">.</span>friends <span class="token operator">=</span> oldA<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>createFriendFromV1<span class="token punctuation">)</span>
			
		<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>oldVersion <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			
			a<span class="token punctuation">.</span>friends <span class="token operator">=</span> oldA<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>createFriendFromV2<span class="token punctuation">)</span>
			
		<span class="token punctuation">&#125;</span>
		
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">// This one is used when</span>
	<span class="token comment">// updating from version 1.</span>
	<span class="token function">createFriendFromV1</span><span class="token punctuation">(</span><span class="token parameter">friendName</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> friendName<span class="token punctuation">,</span>
			<span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// All old friends gets age 0 by default.</span>
			<span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token comment">// All old friends gets empty string by default.</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">// This one is used when</span>
	<span class="token comment">// updating from version 2.</span>
	<span class="token function">createFriendFromV2</span><span class="token punctuation">(</span><span class="token parameter">friend</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> friend<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
			<span class="token literal-property property">age</span><span class="token operator">:</span> friend<span class="token punctuation">.</span>age<span class="token punctuation">,</span>
			<span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token comment">// All old friends gets empty string by default.</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre></div> <h3 data-svelte-h="svelte-1d81o8u">Updating the page states</h3> <p data-svelte-h="svelte-4g8baf">After <code>App.onUpdate()</code> has been called, it&#39;s time to update the data in your pages.</p> <p data-svelte-h="svelte-174hf0a">The default update behavior for the page variables is very similar to app variables; for each page stored in the state that also exists in the new version of the app:</p> <ol data-svelte-h="svelte-vsa9vk"><li>Create all page variables with the default values they should have according to the new version of your app</li> <li>For each page variable that exists both in the stored state and in the new version of the page:<ul><li>Copy over the value from the stored state to the page variable in the page</li></ul></li></ol> <p data-svelte-h="svelte-g5n71a">If you need some additional update logic in your pages, you can add the <code>onUpdate()</code> method to them too. It will be called with two arguments:</p> <ol data-svelte-h="svelte-1shxabe"><li><code>oldP</code>, which contains the old page variables for the page</li> <li><code>oldVersion</code>, which contains the old version (an integer) of the app the user has run before</li></ol></main> <div class="footer svelte-e9cs16"><footer class="svelte-d9hz5y">Copyright Peter L-G 2025 |
	<a href="/motivation" data-svelte-h="svelte-10nr0t7">Motivation</a> |
	<a href="/glossary" data-svelte-h="svelte-1ftqd2z">Glossary</a> </footer></div> </div> 
			
			<script>
				{
					__sveltekit_1c823r3 = {
						base: new URL("../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [null,null,null];

					Promise.all([
						import("../../_app/immutable/entry/start.DfGQzRaj.js"),
						import("../../_app/immutable/entry/app.4nlP2jWE.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 38],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
